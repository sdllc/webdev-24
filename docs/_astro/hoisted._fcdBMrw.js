const S="$collection-search",y="minisearch-worker.mjs";let n;const c=new Map;let _=100;const x={fuzzy:.3,prefix:!0},f=r=>{if(n)return;if(!r&&typeof document<"u"){let e="/webdev-24";e.endsWith("/")||(e+="/"),r=new URL(e,document.baseURI).toString()}const t=[S,y];n=new Worker(new URL(t.join("/"),r||"")),n.onmessage=e=>{if(typeof e.data=="object")switch(e.data.type){case"search-error":{const o=c.get(e.data.transaction);o&&(c.delete(e.data.transaction),o.reject(e.data.message))}break;case"search-results":{const o=c.get(e.data.transaction);o&&(c.delete(e.data.transaction),o.resolve(e.data.list))}break}},n.postMessage({type:"init",base_uri:r})},L=r=>{f(r)},v=(r,t={})=>{f(t.base_uri),t={...x,...t};const e=_++;return new Promise((o,s)=>{if(!n)throw new Error("worker failed");c.set(e,{resolve:o,reject:s}),n.postMessage({type:"search",query:r,options:t,transaction:e})})},b={create_link:r=>{let t="/webdev-24";return t.endsWith("/")||(t+="/"),(t+r.collection+"/"+r.file.replace(/\.mdx{0,1}$/,"")).toLowerCase()},group_header:r=>`Results from ${r}:`,no_results_text:"Your search returned no results",input_placeholder:"Search"},w=()=>{u||p(),u?.Open()},p=(r={})=>{if(!u){const t=document.querySelector("#overlay-search-dialog");if(t instanceof HTMLDialogElement)u=new q(t,{...b,...r});else throw"overlay search: dialog element not found"}};class q{constructor(t,e){this.dialog=t,this.options=e,this.selected_index=-1,document.body.append(t),this.input=t.querySelector(".query"),this.results=t.querySelector(".search-results-list"),this.template=t.querySelector(".result-template"),this.clear_button=t.querySelector(".clear-query"),this.group_template=t.querySelector(".result-group-header-template"),this.default_content=t.querySelector(".default-content"),this.input.placeholder=e.input_placeholder,t.addEventListener("mousedown",s=>{s.target===t&&t.close()}),this.results.addEventListener("focusin",s=>{s.target instanceof HTMLElement&&s.target.classList.contains("search-result")&&this.SelectElement(s.target)}),this.results.addEventListener("mousemove",s=>{s.target instanceof HTMLElement&&s.target.classList.contains("search-result")&&this.SelectElement(s.target)}),document.addEventListener("pagehide",()=>{this.dialog.close()});let o=0;this.results.addEventListener("scroll",s=>{o||(o=window.setTimeout(()=>{sessionStorage.setItem("scroll-top",this.results.scrollTop.toString()),o=0},250))}),this.input.addEventListener("input",async()=>{const s=this.input.value.trim();if(s){const i=await v(s,e.search_options);this.PopulateResults(i),this.results.scrollTop=0,this.StoreSessionData(s,"",i)}else this.results.textContent="",this.SetResultsState("no-query"),this.default_content.style.display="block",this.StoreSessionData()}),this.clear_button.addEventListener("click",()=>{this.input.value="",this.results.textContent="",this.StoreSessionData(),this.input.focus()}),this.Init()}StoreSessionData(t="",e="",o=[]){sessionStorage.setItem("query",t),sessionStorage.setItem("selected-index",e.toString()),sessionStorage.setItem("results",JSON.stringify(o))}SetResultsState(t){switch(t){case"no-query":this.results.classList.remove("no-results"),this.results.classList.remove("results"),this.results.classList.add("no-query");break;case"no-results":this.results.classList.add("no-results"),this.results.classList.remove("results"),this.results.classList.remove("no-query");break;case"results":this.results.classList.remove("no-results"),this.results.classList.add("results"),this.results.classList.remove("no-query");break}}SelectElement(t){this.active_node!==t&&(this.active_node&&this.active_node.classList.remove("active"),this.active_node=t,this.active_node.classList.add("active"),this.selected_index=Number(this.active_node.dataset.index),sessionStorage.setItem("selected-index",this.selected_index.toString()))}SetContent(t,e){for(const[o,s]of Object.entries(e)){const i=t.querySelector(`[data-target=${o}]`);if(i)if(typeof s=="string")i.textContent=s;else{typeof s.text=="string"&&(i.textContent=s.text);for(const l of Object.entries(s.attributes))i.setAttribute(...l)}}return t}PopulateResults(t){if(this.default_content.style.display="none",this.options.threshold){const e=this.options.threshold;t=t.filter(o=>o.score>=e)}if(this.options.filter){const e=this.options.filter;t=t.filter(o=>e(o))}if(this.options.max&&(t=t.slice(0,this.options.max)),!t.length)this.results.textContent=this.options.no_results_text,this.SetResultsState("no-results");else{this.results.textContent="",this.SetResultsState("results");const e={};for(const s of t){const i=s.collection;e[i]||(e[i]=[]),e[i].push(s)}let o=0;for(const[s,i]of Object.entries(e)){const l=this.group_template.content.cloneNode(!0);this.SetContent(l,{"result-group-header":this.options.group_header(s)}),this.results.append(l),this.results.append(...i.map(a=>{const h=this.template.content.cloneNode(!0),d=this.options.create_link(a),m=this.options.format_description?this.options.format_description(a):a.frontmatter.description||"No description",g=this.options.format_title?this.options.format_title(a):a.frontmatter.title||"No title";return this.SetContent(h,{title:g,description:m,result:{attributes:{"data-link":d,"data-index":(o++).toString(),href:d}}}),h}))}}}Open(){L(),this.dialog.showModal();const t=sessionStorage.getItem("scroll-top");t&&requestAnimationFrame(()=>{this.results.scrollTop=Number(t)})}Init(){const t=sessionStorage.getItem("query")||"";this.input.value=t,this.SetResultsState("no-query");const e=sessionStorage.getItem("results");if(e&&t)try{const s=JSON.parse(e);Array.isArray(s)&&this.PopulateResults(s)}catch(s){console.error(s)}let o=sessionStorage.getItem("selected-index");if(o){this.selected_index=Number(o);const s=this.dialog.querySelector(`[data-index="${this.selected_index}"]`);s instanceof HTMLElement&&(this.active_node=s,this.active_node.classList.add("active"))}}}let u;p({max:12,group_header:r=>{switch(r){case"kb":return"Results from the knowledge base:";default:return"Results from help pages:"}},format_description:r=>{if(r.frontmatter.description)return r.frontmatter.description;if(r.frontmatter.tags)try{return console.info("t",r.frontmatter.tags),self.X=r.frontmatter.tags,`Tags: ${JSON.parse(r.frontmatter.tags).join(", ")}`}catch{return"Tags: (parsing tags failed)"}return"No description"}});const k=document.querySelector("[data-trigger-search]");console.info(1,k);document.querySelector("[data-trigger-search]")?.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),w()});
